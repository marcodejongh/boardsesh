│ Plan to implement                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                      │
│ Milestone 7: New Climb Feed + Subscriptions                                                                                                                                                                                          │
│                                                                                                                                                                                                                                      │
│ Context                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                      │
│ Users need a way to discover new climbs being created on their board type/layout, get notified when followed setters create climbs, and subscribe to new climb notifications for specific board+layout combinations. This is the     │
│ last major social feature before unified search (Milestone 8).                                                                                                                                                                       │
│                                                                                                                                                                                                                                      │
│ The key architectural decision: Move climb creation from the Next.js API route into a GraphQL mutation on the backend. This naturally integrates with the existing event pipeline (EventBroker + NotificationWorker) without needing │
│  a cross-process bridge.                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Implementation Steps                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                      │
│ Step 1: DB Schema — new_climb_subscriptions table                                                                                                                                                                                    │
│                                                                                                                                                                                                                                      │
│ Create: packages/db/src/schema/app/new-climb-subscriptions.ts                                                                                                                                                                        │
│                                                                                                                                                                                                                                      │
│ Table definition per the social features plan section 1.6:                                                                                                                                                                           │
│ - id bigserial PK                                                                                                                                                                                                                    │
│ - user_id text FK -> users.id CASCADE                                                                                                                                                                                                │
│ - board_type text                                                                                                                                                                                                                    │
│ - layout_id integer                                                                                                                                                                                                                  │
│ - created_at timestamp DEFAULT now()                                                                                                                                                                                                 │
│ - Unique index: (user_id, board_type, layout_id)                                                                                                                                                                                     │
│ - Index: (user_id), (board_type, layout_id)                                                                                                                                                                                          │
│                                                                                                                                                                                                                                      │
│ Follow the exact pattern from packages/db/src/schema/app/follows.ts (Drizzle pgTable, uniqueIndex, index).                                                                                                                           │
│                                                                                                                                                                                                                                      │
│ Modify: packages/db/src/schema/app/index.ts — add export * from './new-climb-subscriptions'                                                                                                                                          │
│                                                                                                                                                                                                                                      │
│ Run: cd packages/db && npx drizzle-kit generate then npm run db:migrate                                                                                                                                                              │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 2: GraphQL Schema + Shared Types                                                                                                                                                                                                │
│                                                                                                                                                                                                                                      │
│ Modify: packages/shared-schema/src/schema.ts                                                                                                                                                                                         │
│                                                                                                                                                                                                                                      │
│ Add types:                                                                                                                                                                                                                           │
│ type NewClimbSubscription { id: ID!, boardType: String!, layoutId: Int!, createdAt: String! }                                                                                                                                        │
│ input NewClimbSubscriptionInput { boardType: String!, layoutId: Int! }                                                                                                                                                               │
│ type NewClimbFeedItem { uuid: ID!, name: String, boardType: String!, layoutId: Int!, setterDisplayName: String, setterAvatarUrl: String, angle: Int, frames: String, difficultyName: String, createdAt: String! }                    │
│ type NewClimbFeedResult { items: [NewClimbFeedItem!]!, totalCount: Int!, hasMore: Boolean! }                                                                                                                                         │
│ input NewClimbFeedInput { boardType: String!, layoutId: Int!, limit: Int, offset: Int }                                                                                                                                              │
│ type NewClimbCreatedEvent { climb: NewClimbFeedItem! }                                                                                                                                                                               │
│                                                                                                                                                                                                                                      │
│ input SaveClimbInput { boardType: String!, layoutId: Int!, name: String!, description: String, isDraft: Boolean!, frames: String!, framesCount: Int, framesPace: Int, angle: Int! }                                                  │
│ input SaveMoonBoardClimbInput { boardType: String!, layoutId: Int!, name: String!, description: String, holds: JSON!, angle: Int!, isDraft: Boolean, userGrade: String, isBenchmark: Boolean, setter: String }                       │
│ type SaveClimbResult { uuid: ID!, synced: Boolean! }                                                                                                                                                                                 │
│                                                                                                                                                                                                                                      │
│ Add to Query: newClimbFeed(input: NewClimbFeedInput!): NewClimbFeedResult!, myNewClimbSubscriptions: [NewClimbSubscription!]!                                                                                                        │
│ Add to Mutation: subscribeNewClimbs(input: NewClimbSubscriptionInput!): Boolean!, unsubscribeNewClimbs(input: NewClimbSubscriptionInput!): Boolean!, saveClimb(input: SaveClimbInput!): SaveClimbResult!, saveMoonBoardClimb(input:  │
│ SaveMoonBoardClimbInput!): SaveClimbResult!                                                                                                                                                                                          │
│ Add to Subscription: newClimbCreated(boardType: String!, layoutId: Int!): NewClimbCreatedEvent!                                                                                                                                      │
│                                                                                                                                                                                                                                      │
│ Modify: packages/shared-schema/src/types.ts — add corresponding TS types including NewClimbCreatedEvent                                                                                                                              │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 3: PubSub — New Climb Channel                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/pubsub/index.ts                                                                                                                                                                                         │
│                                                                                                                                                                                                                                      │
│ Add a 5th subscriber type following the existing comment channel pattern:                                                                                                                                                            │
│ - type NewClimbSubscriber = (event: NewClimbCreatedEvent) => void;                                                                                                                                                                   │
│ - private newClimbSubscribers: Map<string, Set<NewClimbSubscriber>>                                                                                                                                                                  │
│ - subscribeNewClimbs(channelKey, callback) — channelKey = ${boardType}:${layoutId}                                                                                                                                                   │
│ - publishNewClimbEvent(channelKey, event)                                                                                                                                                                                            │
│ - dispatchToLocalNewClimbSubscribers(channelKey, event)                                                                                                                                                                              │
│                                                                                                                                                                                                                                      │
│ Wire up the Redis message handler in setupRedisMessageHandlers().                                                                                                                                                                    │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/pubsub/redis-adapter.ts                                                                                                                                                                                 │
│                                                                                                                                                                                                                                      │
│ Add NEW_CLIMB_CHANNEL_PREFIX = 'boardsesh:new-climbs:' and the full set of methods following the comment channel pattern:                                                                                                            │
│ - publishNewClimbEvent, subscribeNewClimbChannel, unsubscribeNewClimbChannel, onNewClimbMessage                                                                                                                                      │
│ - Update RedisMessage union type and subscriber.on('message') handler                                                                                                                                                                │
│ - Update RedisPubSubAdapter interface                                                                                                                                                                                                │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 4: Backend — saveClimb GraphQL Mutation                                                                                                                                                                                         │
│                                                                                                                                                                                                                                      │
│ Create: packages/backend/src/graphql/resolvers/climbs/mutations.ts                                                                                                                                                                   │
│                                                                                                                                                                                                                                      │
│ Move the climb creation logic from packages/web/app/lib/api-wrappers/aurora/saveClimb.ts into a GraphQL mutation:                                                                                                                    │
│                                                                                                                                                                                                                                      │
│ export const climbMutations = {                                                                                                                                                                                                      │
│   saveClimb: async (_, { input }, ctx) => {                                                                                                                                                                                          │
│     requireAuthenticated(ctx);                                                                                                                                                                                                       │
│     applyRateLimit(ctx, 10);                                                                                                                                                                                                         │
│     // Validate input with Zod                                                                                                                                                                                                       │
│     // Generate UUID, insert into UNIFIED_TABLES.climbs (same logic as existing saveClimb.ts)                                                                                                                                        │
│     // After successful insert: publishSocialEvent({ type: 'climb.created', ... })                                                                                                                                                   │
│     return { uuid, synced: false };                                                                                                                                                                                                  │
│   },                                                                                                                                                                                                                                 │
│   saveMoonBoardClimb: async (_, { input }, ctx) => {                                                                                                                                                                                 │
│     // Similar but with Moonboard-specific hold encoding and optional grade stats                                                                                                                                                    │
│   },                                                                                                                                                                                                                                 │
│ };                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                      │
│ Reuse existing utilities:                                                                                                                                                                                                            │
│ - UNIFIED_TABLES from packages/backend/src/db/queries/util/table-select.ts                                                                                                                                                           │
│ - generateUuid pattern from packages/web/app/lib/api-wrappers/aurora/util.ts (reimplement in backend or use crypto.randomUUID())                                                                                                     │
│ - publishSocialEvent from packages/backend/src/events/index.ts                                                                                                                                                                       │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/graphql/resolvers/index.ts — import and spread climbMutations                                                                                                                                           │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 5: Backend — Subscription Management Resolvers                                                                                                                                                                                  │
│                                                                                                                                                                                                                                      │
│ Create: packages/backend/src/graphql/resolvers/social/new-climb-subscriptions.ts                                                                                                                                                     │
│                                                                                                                                                                                                                                      │
│ Queries:                                                                                                                                                                                                                             │
│ - newClimbFeed(input) — Query boardClimbs filtered by boardType + layoutId, JOIN with boardClimbStats for difficulty and users/userProfiles for setter info. ORDER BY createdAt DESC. Offset/limit pagination. No auth required.     │
│ - myNewClimbSubscriptions — Requires auth. SELECT from newClimbSubscriptions WHERE userId = ctx.userId.                                                                                                                              │
│                                                                                                                                                                                                                                      │
│ Mutations:                                                                                                                                                                                                                           │
│ - subscribeNewClimbs(input) — Requires auth. INSERT with onConflictDoNothing(). Rate limited.                                                                                                                                        │
│ - unsubscribeNewClimbs(input) — Requires auth. DELETE matching row.                                                                                                                                                                  │
│                                                                                                                                                                                                                                      │
│ Create: packages/backend/src/graphql/resolvers/social/new-climb-feed-subscription.ts                                                                                                                                                 │
│                                                                                                                                                                                                                                      │
│ WebSocket subscription following packages/backend/src/graphql/resolvers/social/comment-subscriptions.ts:                                                                                                                             │
│ - Validate boardType against SUPPORTED_BOARDS and layoutId is positive integer                                                                                                                                                       │
│ - Channel key: ${boardType}:${layoutId}                                                                                                                                                                                              │
│ - Use createAsyncIterator from packages/backend/src/graphql/resolvers/shared/async-iterators.ts                                                                                                                                      │
│ - Yield { newClimbCreated: event }                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/graphql/resolvers/index.ts — add to Query, Mutation, and Subscription                                                                                                                                   │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 6: Backend — NotificationWorker + Recipient Resolution                                                                                                                                                                          │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/events/notification-worker.ts                                                                                                                                                                           │
│                                                                                                                                                                                                                                      │
│ Add case 'climb.created': await this.handleClimbCreated(event);                                                                                                                                                                      │
│                                                                                                                                                                                                                                      │
│ The handleClimbCreated method:                                                                                                                                                                                                       │
│ 1. Extract boardType, layoutId, climbName from event metadata                                                                                                                                                                        │
│ 2. Get follower recipients (people following the setter) → new_climb notifications                                                                                                                                                   │
│ 3. Get subscription recipients (people subscribed to board+layout) → new_climb_global notifications                                                                                                                                  │
│ 4. Deduplicate: followers take priority (if someone is both follower + subscriber → one new_climb notification)                                                                                                                      │
│ 5. Create notifications for all recipients (excluding actor)                                                                                                                                                                         │
│ 6. Fan out feed items to followers                                                                                                                                                                                                   │
│ 7. Publish real-time event via pubsub.publishNewClimbEvent(channelKey, event)                                                                                                                                                        │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/events/recipient-resolution.ts                                                                                                                                                                          │
│                                                                                                                                                                                                                                      │
│ Add two new functions:                                                                                                                                                                                                               │
│ - resolveClimbCreatedFollowerRecipients(setterId) — query userFollows WHERE followingId = setterId                                                                                                                                   │
│ - resolveClimbCreatedSubscriptionRecipients(boardType, layoutId, excludeUserId) — query newClimbSubscriptions WHERE boardType AND layoutId                                                                                           │
│                                                                                                                                                                                                                                      │
│ Both return RecipientInfo[] with appropriate notificationType.                                                                                                                                                                       │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/events/feed-fanout.ts                                                                                                                                                                                   │
│                                                                                                                                                                                                                                      │
│ Add fanoutNewClimbFeedItems(event) — same pattern as fanoutFeedItems but with type: 'new_climb' and entityType: 'climb'.                                                                                                             │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/events/index.ts                                                                                                                                                                                         │
│                                                                                                                                                                                                                                      │
│ Add climb.created case to createInlineNotification fallback (for non-Redis mode). Since it's multi-recipient, do basic fan-out + WS publishing inline.                                                                               │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/events/notification-worker.ts enrichNotification method                                                                                                                                                 │
│                                                                                                                                                                                                                                      │
│ Add climb metadata lookup for new_climb and new_climb_global notification types: fetch climbName, climbUuid, boardType from boardClimbs table.                                                                                       │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 7: Frontend — Update saveClimb Callers                                                                                                                                                                                          │
│                                                                                                                                                                                                                                      │
│ Modify: packages/web/app/components/board-provider/board-provider-context.tsx                                                                                                                                                        │
│                                                                                                                                                                                                                                      │
│ Change saveClimb to call the GraphQL backend mutation instead of fetch('/api/v1/.../proxy/saveClimb'). Use the existing graphql-ws client pattern (the execute helper from                                                           │
│ packages/web/app/components/graphql-queue/graphql-client.ts).                                                                                                                                                                        │
│                                                                                                                                                                                                                                      │
│ Modify: packages/web/app/components/create-climb/create-climb-form.tsx                                                                                                                                                               │
│                                                                                                                                                                                                                                      │
│ Update the MoonBoard save path to also go through GraphQL (replace direct fetch call with the saveMoonBoardClimb mutation via the GraphQL client).                                                                                   │
│                                                                                                                                                                                                                                      │
│ Keep for now: packages/web/app/api/v1/[board_name]/proxy/saveClimb/route.ts — keep the API route as a fallback / deprecation path. Don't delete it yet, but it won't trigger notifications.                                          │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 8: Frontend — GraphQL Operations                                                                                                                                                                                                │
│                                                                                                                                                                                                                                      │
│ Create: packages/web/app/lib/graphql/operations/new-climb-feed.ts                                                                                                                                                                    │
│                                                                                                                                                                                                                                      │
│ Define all GraphQL operations:                                                                                                                                                                                                       │
│ - GET_NEW_CLIMB_FEED query                                                                                                                                                                                                           │
│ - GET_MY_NEW_CLIMB_SUBSCRIPTIONS query                                                                                                                                                                                               │
│ - SUBSCRIBE_NEW_CLIMBS mutation                                                                                                                                                                                                      │
│ - UNSUBSCRIBE_NEW_CLIMBS mutation                                                                                                                                                                                                    │
│ - NEW_CLIMB_CREATED_SUBSCRIPTION subscription                                                                                                                                                                                        │
│ - SAVE_CLIMB_MUTATION mutation                                                                                                                                                                                                       │
│ - SAVE_MOONBOARD_CLIMB_MUTATION mutation                                                                                                                                                                                             │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 9: Frontend — New Climb Feed Components                                                                                                                                                                                         │
│                                                                                                                                                                                                                                      │
│ Create: packages/web/app/components/new-climb-feed/subscribe-button.tsx                                                                                                                                                              │
│                                                                                                                                                                                                                                      │
│ MUI toggle button with notification bell icon. Uses execute() from graphql-client to call subscribe/unsubscribe mutations. Props: boardType, layoutId, isSubscribed, onSubscriptionChange.                                           │
│                                                                                                                                                                                                                                      │
│ Create: packages/web/app/components/new-climb-feed/new-climb-feed-item.tsx                                                                                                                                                           │
│                                                                                                                                                                                                                                      │
│ Card component for a new climb. Reuse AscentThumbnail from packages/web/app/components/activity-feed/ascent-thumbnail.tsx. Show: setter avatar+name, climb name, difficulty chip, angle chip, board type, relative time, board       │
│ thumbnail.                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                      │
│ Create: packages/web/app/components/new-climb-feed/new-climb-feed.tsx                                                                                                                                                                │
│                                                                                                                                                                                                                                      │
│ Main feed component:                                                                                                                                                                                                                 │
│ 1. Fetch initial data via execute() with GET_NEW_CLIMB_FEED                                                                                                                                                                          │
│ 2. Subscribe to NEW_CLIMB_CREATED_SUBSCRIPTION via subscribe() from graphql-client for real-time updates                                                                                                                             │
│ 3. Prepend new climbs to the list as they arrive                                                                                                                                                                                     │
│ 4. Offset-based pagination with "Load more" button                                                                                                                                                                                   │
│ 5. Props: boardType, layoutId, isAuthenticated, isSubscribed                                                                                                                                                                         │
│                                                                                                                                                                                                                                      │
│ Create: packages/web/app/components/new-climb-feed/index.ts — barrel export                                                                                                                                                          │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 10: Frontend — Home Page Integration                                                                                                                                                                                            │
│                                                                                                                                                                                                                                      │
│ Modify: packages/web/app/home-page-content.tsx                                                                                                                                                                                       │
│                                                                                                                                                                                                                                      │
│ Add tab system to toggle between "Activity" and "New Climbs":                                                                                                                                                                        │
│ - Use MUI Tabs / Tab components                                                                                                                                                                                                      │
│ - "Activity" tab shows existing ActivityFeed                                                                                                                                                                                         │
│ - "New Climbs" tab shows NewClimbFeed (needs a board+layout selector or uses the user's default board)                                                                                                                               │
│ - When selectedBoardUuid is set via BoardSelectorPills, use it to determine boardType+layoutId for the new climb feed                                                                                                                │
│ - Persist selected tab preference to IndexedDB via setPreference/getPreference                                                                                                                                                       │
│                                                                                                                                                                                                                                      │
│ The New Climbs tab needs a board+layout to filter by. When a user selects a board via BoardSelectorPills, look up the board's boardType and layoutId from the board entity. If no board is selected, show a prompt to select or      │
│ create a board first.                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 11: Validation Schemas                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                      │
│ Modify: packages/backend/src/validation/schemas.ts                                                                                                                                                                                   │
│                                                                                                                                                                                                                                      │
│ Add Zod schemas:                                                                                                                                                                                                                     │
│ - NewClimbSubscriptionInputSchema                                                                                                                                                                                                    │
│ - NewClimbFeedInputSchema                                                                                                                                                                                                            │
│ - SaveClimbInputSchema                                                                                                                                                                                                               │
│ - SaveMoonBoardClimbInputSchema                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Step 12: Update Milestone Doc                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                      │
│ Modify: docs/social-features-plan.md                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                      │
│ Mark Milestone 7 as [COMPLETED].                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                      │
│ ---                                                                                                                                                                                                                                  │
│ Files Summary                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                      │
│ New Files                                                                                                                                                                                                                            │
│ ┌──────────────────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────┐                                                                                                    │
│ │                                     File                                     │                    Purpose                     │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/db/src/schema/app/new-climb-subscriptions.ts                        │ DB table schema                                │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/backend/src/graphql/resolvers/climbs/mutations.ts                   │ saveClimb GraphQL mutation                     │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/backend/src/graphql/resolvers/social/new-climb-subscriptions.ts     │ Feed query + subscription management mutations │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/backend/src/graphql/resolvers/social/new-climb-feed-subscription.ts │ WebSocket subscription resolver                │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/web/app/lib/graphql/operations/new-climb-feed.ts                    │ Frontend GraphQL operations                    │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/web/app/components/new-climb-feed/subscribe-button.tsx              │ Subscribe toggle button                        │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/web/app/components/new-climb-feed/new-climb-feed-item.tsx           │ Feed item card                                 │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/web/app/components/new-climb-feed/new-climb-feed.tsx                │ Main feed with live updates                    │                                                                                                    │
│ ├──────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────┤                                                                                                    │
│ │ packages/web/app/components/new-climb-feed/index.ts                          │ Barrel export                                  │                                                                                                    │
│ └──────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────┘                                                                                                    │
│ Modified Files                                                                                                                                                                                                                       │
│ ┌───────────────────────────────────────────────────────────────────────┬──────────────────────────────────────────────────────────┐                                                                                                 │
│ │                                 File                                  │                         Changes                          │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/db/src/schema/app/index.ts                                   │ Export new table                                         │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/shared-schema/src/schema.ts                                  │ Add GraphQL types/inputs/queries/mutations/subscriptions │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/shared-schema/src/types.ts                                   │ Add TS types                                             │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/backend/src/pubsub/index.ts                                  │ Add newClimb channel (subscribe/publish/dispatch)        │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/backend/src/pubsub/redis-adapter.ts                          │ Add newClimb Redis channel                               │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/backend/src/graphql/resolvers/index.ts                       │ Register new resolvers                                   │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/backend/src/events/notification-worker.ts                    │ Handle climb.created event + enrich notifications        │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/backend/src/events/recipient-resolution.ts                   │ Add follower + subscription recipient resolvers          │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/backend/src/events/feed-fanout.ts                            │ Add fanoutNewClimbFeedItems                              │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/backend/src/events/index.ts                                  │ Add climb.created inline fallback                        │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/backend/src/validation/schemas.ts                            │ Add Zod schemas                                          │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/web/app/components/board-provider/board-provider-context.tsx │ Use GraphQL mutation for saveClimb                       │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/web/app/components/create-climb/create-climb-form.tsx        │ Use GraphQL for Moonboard save                           │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ packages/web/app/home-page-content.tsx                                │ Add "New Climbs" tab                                     │                                                                                                 │
│ ├───────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤                                                                                                 │
│ │ docs/social-features-plan.md                                          │ Mark milestone 7 as completed                            │                                                                                                 │
│ └───────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────┘                                                                                                 │
│ Existing Code to Reuse                                                                                                                                                                                                               │
│ ┌───────────────────────────────────────────┬───────────────────────────────────────────────────────────────────┐                                                                                                                    │
│ │              Pattern/Utility              │                               File                                │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ UNIFIED_TABLES.climbs                     │ packages/backend/src/db/queries/util/table-select.ts              │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ publishSocialEvent()                      │ packages/backend/src/events/index.ts                              │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ fanoutFeedItems() pattern                 │ packages/backend/src/events/feed-fanout.ts                        │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ RecipientInfo type                        │ packages/backend/src/events/recipient-resolution.ts               │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ createAsyncIterator()                     │ packages/backend/src/graphql/resolvers/shared/async-iterators.ts  │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ requireAuthenticated() / applyRateLimit() │ packages/backend/src/graphql/resolvers/shared/helpers.ts          │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ AscentThumbnail component                 │ packages/web/app/components/activity-feed/ascent-thumbnail.tsx    │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ createGraphQLClient / execute / subscribe │ packages/web/app/components/graphql-queue/graphql-client.ts       │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ FeedItemNewClimb design                   │ packages/web/app/components/activity-feed/feed-item-new-climb.tsx │                                                                                                                    │
│ ├───────────────────────────────────────────┼───────────────────────────────────────────────────────────────────┤                                                                                                                    │
│ │ Comment channel PubSub pattern            │ packages/backend/src/pubsub/index.ts lines 421-484                │                                                                                                                    │
│ └───────────────────────────────────────────┴───────────────────────────────────────────────────────────────────┘                                                                                                                    │
│ ---                                                                                                                                                                                                                                  │
│ Verification                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                      │
│ Typecheck                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                      │
│ npm run typecheck                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                      │
│ Manual Testing                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                      │
│ 1. New climb feed: Navigate to home page, select "New Climbs" tab with a board selected. Verify recent climbs appear for that board+layout.                                                                                          │
│ 2. Subscribe: Click "Subscribe" button for a board+layout. Verify subscription is persisted (reload page, button shows "Subscribed").                                                                                                │
│ 3. Create climb + feed update: With the feed open in one browser tab, create a new climb in another tab. Verify the climb appears in real-time in the feed tab.                                                                      │
│ 4. Notifications: Follow a user, have them create a climb. Verify you receive a new_climb notification. Subscribe to a board+layout, have someone else create a climb on that config. Verify you receive a new_climb_global          │
│ notification.                                                                                                                                                                                                                        │
│ 5. Dedup: Be both a follower of a setter AND subscribed to their board+layout. Create a climb. Verify you get exactly ONE notification (type new_climb, not two).                                                                    │
│ 6. saveClimb migration: Create a climb via the existing UI (Aurora boards and Moonboard). Verify it still saves correctly and now also publishes events.                                                                             │
│                                                                                                                                                                                                                                      │
│ Edge Cases                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                      │
│ - Unsubscribe and verify no more notifications                                                                                                                                                                                       │
│ - Non-authenticated users see the feed but not the subscribe button                                                                                                                                                                  │
│ - Creating a draft climb should still publish events (setters may want to preview)  